<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatAI</title>
    <link rel="icon" href="chat-ai-favicon.ico" type="image/x-icon">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background-image: url('fiscozen-frontoffice.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        /* Custom Freshchat widget styling for extended dimensions */
        .custom_fc_frame {
            width: 400px !important;
            height: 600px !important;
            max-height: 90vh !important;
            right: 20px !important;
            bottom: 20px !important;
        }
    </style>
</head>
<body>
    <!-- Freshchat Widget Configuration - Must be placed BEFORE the widget script -->
    <script>
        window.fcWidgetMessengerConfig = {
            // Provide the externalId here to initialize the widget with the correct user context
            externalId: "161091", 
            config: {
                cssNames: {
                    widget: "custom_fc_frame"
                },
                headerProperty: {
                    appName: 'Fiscozen Support',
                    appLogo: 'https://via.placeholder.com/40x40/007bff/ffffff?text=F'
                },
                content: {
                    placeholders: {
                        reply_field: 'Type your message...'
                    },
                    headers: {
                        chat: 'Chat with Fiscozen Support'
                    }
                },
                fullscreen: false
            }
        };
    </script>

    <!-- Freshchat Widget Script -->
    <script src='//eu.fw-cdn.com/13069928/1021706.js' chat='true'></script>
    
    <!-- User Property Update Script -->
    <script>
        function initializeFreshchat() {
            if (typeof window.fcWidget !== 'undefined') {
                console.log("Freshchat widget is ready. Updating user properties...");

                // The user is now identified via externalId in the config.
                // We now just update their properties to ensure they are current.
                window.fcWidget.user.setFirstName("Mario");
                window.fcWidget.user.setLastName("Rossi");
                window.fcWidget.user.setEmail("mario.rossi@fiscozen.it");
                window.fcWidget.user.setPhone("+393456789012");
                window.fcWidget.user.setProperties({
                    payment_status: "active",
                    fiscal_regime: "Forfettario",
                    welfare_institution: "GS INPS",
                    ateco_1: "73.11.02",
                    ssn: "RSSMRA85M01H501Z",
                    consultant_squad_id: "01-Amelis"
                });
                console.log("User properties updated successfully.");

                // Auto-open the widget
                window.fcWidget.open();
                console.log("Freshchat widget opened automatically.");

            } else {
                // If widget is not ready, wait 100ms and try again
                setTimeout(initializeFreshchat, 100);
            }
        }

        // Start the process after the page has loaded
        window.onload = initializeFreshchat;
    </script>
    
</body>
</html>
